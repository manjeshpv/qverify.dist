{"version":3,"sources":["api/user/user.controller.js"],"names":[],"mappings":"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","file":"api/user/user.controller.js","sourcesContent":["/**\n * Using Rails-like standard naming convention for endpoints.\n * GET     /api/users              ->  index\n * POST    /api/users              ->  create\n * GET     /api/users/:id          ->  show\n * PUT     /api/users/:id          ->  update\n * DELETE  /api/users/:id          ->  destroy\n */\n\n'use strict';\n\nimport _ from 'lodash';\nimport config from '../../config/environment';\nimport {User, Company} from '../../sqldb';\nvar rp = require('request-promise');\n\nfunction respondWithResult(res, statusCode) {\n  statusCode = statusCode || 200;\n  return function (entity) {\n    if (entity) {\n      res.status(statusCode).json(entity);\n    }\n  };\n}\n\nfunction saveUpdates(updates) {\n  return function (entity) {\n    return entity.updateAttributes(updates)\n      .then(updated => {\n        return updated;\n      });\n  };\n}\n\nfunction removeEntity(res) {\n  return function (entity) {\n    if (entity) {\n      return entity.destroy()\n        .then(() => {\n          res.status(204).end();\n        });\n    }\n  };\n}\n\nfunction handleEntityNotFound(res) {\n  return function (entity) {\n    if (!entity) {\n      res.status(404).end();\n      return null;\n    }\n    return entity;\n  };\n}\n\nfunction handleError(res, statusCode) {\n  statusCode = statusCode || 500;\n  return function (err) {\n    res.status(statusCode).send(err);\n  };\n}\n\n// Gets a list of Users\nexport function index(req, res) {\n  return User.findAll({\n    attributes: ['id', 'name'],\n    where: whereClause,\n    include: [\n      { model: Company, attributes:['name']},\n       ]\n  })\n    .then(respondWithResult(res))\n    .catch(handleError(res));\n}\n\n// Gets a single User from the DB\nexport function show(req, res) {\n  return User.find({\n      where: {\n        _id: req.params.id\n      }\n    })\n    .then(handleEntityNotFound(res))\n    .then(respondWithResult(res))\n    .catch(handleError(res));\n}\n\n// Creates a new User in the DB\nexport function create(req, res) {\n\n  return User.create(req.body)\n    .then(respondWithResult(res, 201))\n    .catch(handleError(res));\n}\n\n// Updates an existing User in the DB\nexport function update(req, res) {\n  if (req.body._id) {\n    delete req.body._id;\n  }\n  return User.find({\n      where: {\n        _id: req.params.id\n      }\n    })\n    .then(handleEntityNotFound(res))\n    .then(saveUpdates(req.body))\n    .then(respondWithResult(res))\n    .catch(handleError(res));\n}\n\n// Deletes a User from the DB\nexport function destroy(req, res) {\n  return User.find({\n      where: {\n        _id: req.params.id\n      }\n    })\n    .then(handleEntityNotFound(res))\n    .then(removeEntity(res))\n    .catch(handleError(res));\n}\n\n// Creates a new User in the DB\nexport function login(req, res) {\n  //console.log(req.params);\n  //console.log(req.query);\n  //console.log(req.body);\n  if (!req.body) return handleError(res, 400, {message: \"Bad Request\"})\n  return User.find({\n    where: {username: req.body.username},\n    include: [{model: Company}]\n  }).then((user)=> {\n    const oAuthChatOptions = {\n      method: 'POST',\n      url: `${config.DOMAIN}/oauth/token`,\n      headers: {\n        'content-type': 'application/x-www-form-urlencoded'\n      },\n      auth: {\n        user: 'accounts',\n        pass: 'accountssecret',\n      },\n      form: {\n        grant_type: 'password',\n        username: req.body.username,\n        password: req.body.password,\n      }\n    };\n    rp(oAuthChatOptions).then((body)=> {\n      return res.json(body);\n    }).catch((err)=> {\n      return res.status(500).send(err);\n    });\n  }).catch((err)=> {\n    console.log(err);\n    return res.status(500).send(err);\n  });\n}\nexport function register(req, res) {\n  //console.log(req.params);\n  //console.log(req.query);\n  //console.log(req.body);\n\n  return User.create(\n    req.body\n  ).then((user)=> {\n    return res.json(user);\n  }).catch((err)=> {\n    console.log(err);\n    return res.status(404).json(\"Invalid data\")\n  });\n}\n\nexport function client(req, res) {\n  return User.findAll({\n      include: [{model: Company,where: {user_type_id:2}}]\n    })\n    .then(respondWithResult(res))\n    .catch(handleError(res));\n}\n\nexport function vendor(req, res) {\n  return User.findAll({\n      include: [{model: Company,where: {user_type_id:3}}]\n    })\n    .then(respondWithResult(res))\n    .catch(handleError(res));\n}\n\n// Gets a list of Users\nexport function me(req, res) {\n  return res.json(req.user || {message: \"not authorized\"})\n}\n"],"sourceRoot":"/source/"}