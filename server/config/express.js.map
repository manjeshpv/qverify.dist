{"version":3,"sources":["config/express.js"],"names":[],"mappings":"AAAA;;;;AAIA;;;;;;kBAee,UAAS,GAAT,EAAc;AAC3B,MAAI,MAAM,IAAI,GAAJ,CAAQ,KAAR,CAAV;;AAEA,MAAI,QAAQ,aAAR,IAAyB,QAAQ,MAArC,EAA6C;AAC3C,QAAI,GAAJ,CAAQ,kBAAQ,MAAR,CAAe,eAAK,IAAL,CAAU,sBAAO,IAAjB,EAAuB,MAAvB,CAAf,CAAR;AACD;;AAED,MAAI,QAAQ,YAAZ,EAA0B;AACxB,QAAI,GAAJ,CAAQ,4BAAQ,eAAK,IAAL,CAAU,sBAAO,IAAjB,EAAuB,QAAvB,EAAiC,aAAjC,CAAR,CAAR;AACD;;AAED,MAAI,GAAJ,CAAQ,sBAAO,KAAP,CAAR;AACA,MAAI,GAAJ,CAAQ,SAAR,EAAmB,eAAK,IAAL,CAAU,sBAAO,IAAjB,EAAuB,QAAvB,CAAnB;AACA,MAAI,GAAJ,CAAQ,kBAAQ,MAAR,CAAe,IAAI,GAAJ,CAAQ,SAAR,CAAf,CAAR;;AAEA,MAAI,GAAJ,CAAQ,OAAR,EAAiB,sBAAO,IAAP,GAAc,eAA/B;AACA,MAAI,GAAJ,CAAQ,aAAR,EAAuB,MAAvB;AACA,MAAI,GAAJ,CAAQ,4BAAR;AACA,MAAI,GAAJ,CAAQ,qBAAW,UAAX,CAAsB,EAAE,UAAU,KAAZ,EAAtB,CAAR;AACA,MAAI,GAAJ,CAAQ,qBAAW,IAAX,EAAR;AACA,MAAI,GAAJ,CAAQ,+BAAR;AACA,MAAI,GAAJ,CAAQ,6BAAR;AACA,MAAI,GAAJ,CAAQ,iBAAR,EAA2B,QAAQ,aAAR,CAA3B;AACA,MAAI,KAAJ;;AAEA;AACA,MAAI,GAAJ,CAAQ,cAAR,EAAwB,IAAI,KAAJ,CAAU,KAAV,EAAxB;;AAEA,MAAI,KAAJ,CAAU,YAAV,GAAyB,QAAQ,sCAAR,CAAzB;;AAEA;AACA,MAAI,GAAJ,CAAQ,YAAR,EAAsB,IAAI,KAAJ,CAAU,YAAV,EAAtB,EAAgD,QAAQ,oBAAR,CAAhD,EAAiF;AACjF,MAAI,GAAJ,CAAQ,gBAAR,EAA0B,IAAI,KAAJ,CAAU,YAAV,EAA1B,EAAoD,QAAQ,oBAAR,CAApD,EAAqF;;AAErF,wBAAO,GAAP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;;;AAIA,MAAI,WAAW,GAAf,EAAoB;AAClB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACD;AAIF,C;;AA/ED;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA","file":"config/express.js","sourcesContent":["/**\r\n * Express configuration\r\n */\r\n\r\n'use strict';\r\n\r\nimport express from 'express';\r\nimport favicon from 'serve-favicon';\r\nimport morgan from 'morgan';\r\nimport compression from 'compression';\r\nimport bodyParser from 'body-parser';\r\nimport methodOverride from 'method-override';\r\nimport cookieParser from 'cookie-parser';\r\nimport errorHandler from 'errorhandler';\r\nimport path from 'path';\r\nimport oAuthComponent from './../components/oauthjs';\r\nimport config from './environment';\r\nimport routes from './../routes.js';\r\n\r\nexport default function(app) {\r\n  var env = app.get('env');\r\n\r\n  if (env === 'development' || env === 'test') {\r\n    app.use(express.static(path.join(config.root, '.tmp')));\r\n  }\r\n\r\n  if (env === 'production') {\r\n    app.use(favicon(path.join(config.root, 'client', 'favicon.ico')));\r\n  }\r\n\r\n  app.use(morgan('dev'));\r\n  app.set('appPath', path.join(config.root, 'client'));\r\n  app.use(express.static(app.get('appPath')));\r\n\r\n  app.set('views', config.root + '/server/views');\r\n  app.set('view engine', 'jade');\r\n  app.use(compression());\r\n  app.use(bodyParser.urlencoded({ extended: false }));\r\n  app.use(bodyParser.json());\r\n  app.use(methodOverride());\r\n  app.use(cookieParser());\r\n  app.use('/api/open/users', require('../api/user'));\r\n  app.oauth = oAuthComponent;\r\n\r\n  // OAuth Token authorization_code, password, refresh_token\r\n  app.all('/oauth/token', app.oauth.grant());\r\n\r\n  app.oauth.authenticate = require('./../components/oauthjs/authenticate')\r\n\r\n  // OAuth Authorise from Third party applications\r\n  app.use('/authorise', app.oauth.authenticate(), require('./../api/authorise'));  // /authorise\r\n  app.use('/api/authorise', app.oauth.authenticate(), require('./../api/authorise'));  // /authorise\r\n\r\n  routes(app);\r\n  //// Persist sessions with MongoStore / sequelizeStore\r\n  //// We need to enable sessions for passport-twitter because it's an\r\n  //// oauth 1.0 strategy, and Lusca depends on sessions\r\n  //app.use(session({\r\n  //  secret: config.secrets.session,\r\n  //  saveUninitialized: true,\r\n  //  resave: false,\r\n  //  store: new Store(sqldb.sequelize)\r\n  //}));\r\n\r\n  /**\r\n   * Lusca - express server security\r\n   * https://github.com/krakenjs/lusca\r\n   */\r\n  if ('test' !== env) {\r\n    //app.use(lusca({\r\n    //  csrf: {\r\n    //    angular: true\r\n    //  },\r\n    //  xframe: 'SAMEORIGIN',\r\n    //  hsts: {\r\n    //    maxAge: 31536000, //1 year, in seconds\r\n    //    includeSubDomains: true,\r\n    //    preload: true\r\n    //  },\r\n    //  xssProtection: true\r\n    //}));\r\n  }\r\n\r\n\r\n\r\n}\r\n"],"sourceRoot":"/source/"}